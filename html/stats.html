<%inherit file="base.html"/>

<%block name="title">Stats</%block>

<%include file="navbar.html"/>

<div class="row">

    <div class="col-md-4">

        <div class="panel panel-primary">

            <div class="panel-heading">
                <h3 class="panel-title">Your Team</h3>
            </div>

            <div class="panel-body">

                <div class="btn-group" role="group">
                    <button type="button" id="your_inhib_plus" class="btn btn-primary">
                        <span class="glyphicon glyphicon-plus"></span>
                    </button>
                    <button type="button" id="your_inhib_minus" class="btn btn-primary">
                        <span class="glyphicon glyphicon-minus"></span>
                    </button>
                </div>
                <span class="lead" style="margin-left:0.5em;"><span id="your_inhibs">0</span> Inhibitors</span>

                <br/>

                <div class="btn-group" role="group">
                    <button type="button" id="your_tower_plus" class="btn btn-primary">
                        <span class="glyphicon glyphicon-plus"></span>
                    </button>
                    <button type="button" id="your_tower_minus" class="btn btn-primary">
                        <span class="glyphicon glyphicon-minus"></span>
                    </button>
                </div>
                <span class="lead" style="margin-left:0.5em;"><span id="your_towers">0</span> Towers</span>

                <br/>

                <div class="btn-group" role="group">
                    <button type="button" id="your_kill_plus" class="btn btn-primary">
                        <span class="glyphicon glyphicon-plus"></span>
                    </button>
                    <button type="button" id="your_kill_minus" class="btn btn-primary">
                        <span class="glyphicon glyphicon-minus"></span>
                    </button>
                </div>
                <span class="lead" style="margin-left:0.5em;"><span id="your_kills">0</span> Kills</span>

            </div>

        </div>

        <div class="panel panel-primary">

            <div class="panel-heading">
                <h3 class="panel-title">Their Team</h3>
            </div>

            <div class="panel-body">

                <div class="btn-group" role="group">
                    <button type="button" id="their_inhib_plus" class="btn btn-primary">
                        <span class="glyphicon glyphicon-plus"></span>
                    </button>
                    <button type="button" id="their_inhib_minus" class="btn btn-primary">
                        <span class="glyphicon glyphicon-minus"></span>
                    </button>
                </div>
                <span class="lead" style="margin-left:0.5em;"><span id="their_inhibs">0</span> Inhibitors</span>

                <br/>

                <div class="btn-group" role="group">
                    <button type="button" id="their_tower_plus" class="btn btn-primary">
                        <span class="glyphicon glyphicon-plus"></span>
                    </button>
                    <button type="button" id="their_tower_minus" class="btn btn-primary">
                        <span class="glyphicon glyphicon-minus"></span>
                    </button>
                </div>
                <span class="lead" style="margin-left:0.5em;"><span id="their_towers">0</span> Towers</span>

                <br/>

                <div class="btn-group" role="group">
                    <button type="button" id="their_kill_plus" class="btn btn-primary">
                        <span class="glyphicon glyphicon-plus"></span>
                    </button>
                    <button type="button" id="their_kill_minus" class="btn btn-primary">
                        <span class="glyphicon glyphicon-minus"></span>
                    </button>
                </div>
                <span class="lead" style="margin-left:0.5em;"><span id="their_kills">0</span> Kills</span>

            </div>

        </div>

    </div>

    <div class="col-md-8">

        <div class="well well-lg">

            <h1>Win Likelihood: <span class="joint_win_percent"></span>%</h1>

            <p class="lead">
            The likelihood of winning a game where your team has <span class="your_inhibs"></span> inhibitors,
            <span class="your_towers"></span> towers, and <span class="your_kills"></span> kills while the opposing
            team has <span class="their_inhibs"></span> inhibitors, <span class="their_towers"></span> towers, and
            <span class="their_kills"></span> kills is <span class="joint_win_percent"></span>%.
            </p>

            <p class="lead">
            There have been <span id="joint_wins"></span> victories and <span id="joint_losses"></span> losses across
            <span id="joint_matches"></span> matches where this was the case.
            </p>

        </div>

        <div class="well well-lg">

            <h1>Win Likelihood: <span class="tower_win_percent"></span>%</h1>

            <p class="lead">
            The likelihood of winning a game where your team has <span class="your_inhibs"></span> inhibitors
            and <span class="your_towers"></span> towers while the opposing team has <span class="their_inhibs"></span>
            inhibitors and <span class="their_towers"></span> towers is <span class="tower_win_percent"></span>%.
            </p>

            <p class="lead">
            There have been <span id="tower_wins"></span> victories and <span id="tower_losses"></span> losses across
            <span id="tower_matches"></span> matches where this was the case.
            </p>

        </div>

        <div class="well well-lg">

            <h1>Win Likelihood: <span class="kill_win_percent"></span>%</h1>

            <p class="lead">
            The likelihood of winning a game where your team has <span class="your_kills"></span> kills
            while the opposing team has <span class="their_kills"></span> kills is <span class="kill_win_percent"></span>%.
            </p>

            <p class="lead">
            There have been <span id="kill_wins"></span> victories and <span id="kill_losses"></span> losses across
            <span id="kill_matches"></span> matches where this was the case.
            </p>

        </div>

    </div>

</div>

<script>

<%include file="joint_stats.js"/>
<%include file="tower_stats.js"/>
<%include file="kill_stats.js"/>

function update_stats() {

    // extract counts from page text
    var youri = parseInt($('#your_inhibs').text());
    var yourt = parseInt($('#your_towers').text());
    var yourk = parseInt($('#your_kills').text());
    var theiri = parseInt($('#their_inhibs').text());
    var theirt = parseInt($('#their_towers').text());
    var theirk = parseInt($('#their_kills').text());

    // lookup joint stats
    var jwins = 0;
    var jlosses = 0;
    var keyj = "[" + youri + "," + yourt + "," + yourk + "," + theiri + "," + theirt + "," + theirk + "]";
    if (keyj in joint_stats) {
        jwins = joint_stats[keyj][0];
        jlosses = joint_stats[keyj][1];
    }
    var jmatches = jwins + jlosses;
    var jwinp = 50;
    if (jmatches > 0) {
        jwinp = Math.round(100 * jwins / jmatches);
    }

    // lookup tower stats
    var twins = 0;
    var tlosses = 0;
    var keyt = "[" + youri + "," + yourt + "," + theiri + "," + theirt + "]";
    if (keyt in tower_stats) {
        twins = tower_stats[keyt][0];
        tlosses = tower_stats[keyt][1];
    }
    var tmatches = twins + tlosses;
    var twinp = 50;
    if (tmatches > 0) {
        twinp = Math.round(100 * twins / tmatches);
    }

    // lookup kill stats
    var kwins = 0;
    var klosses = 0;
    var keyk = "[" + yourk + "," + theirk + "]";
    if (keyk in kill_stats) {
        kwins = kill_stats[keyk][0];
        klosses = kill_stats[keyk][1];
    }
    var kmatches = kwins + klosses;
    var kwinp = 50;
    if (kmatches > 0) {
        kwinp = Math.round(100 * kwins / kmatches);
    }

    // lastly update text on the page
    $('.your_inhibs').text(youri);
    $('.your_towers').text(yourt);
    $('.your_kills').text(yourk);
    $('.their_inhibs').text(theiri);
    $('.their_towers').text(theirt);
    $('.their_kills').text(theirk);
    $('#joint_wins').text(jwins);
    $('#joint_losses').text(jlosses);
    $('#joint_matches').text(jmatches);
    $('.joint_win_percent').text(jwinp);
    $('#tower_wins').text(twins);
    $('#tower_losses').text(tlosses);
    $('#tower_matches').text(tmatches);
    $('.tower_win_percent').text(twinp);
    $('#kill_wins').text(kwins);
    $('#kill_losses').text(klosses);
    $('#kill_matches').text(kmatches);
    $('.kill_win_percent').text(kwinp);
};

$('#your_inhib_plus').click(function() {
    $('#your_inhibs').text(parseInt($('#your_inhibs').text()) + 1);
    update_stats();
});

$('#your_inhib_minus').click(function() {
    $('#your_inhibs').text(parseInt($('#your_inhibs').text()) - 1);
    update_stats();
});

$('#your_tower_plus').click(function() {
    $('#your_towers').text(parseInt($('#your_towers').text()) + 1);
    update_stats();
});

$('#your_tower_minus').click(function() {
    $('#your_towers').text(parseInt($('#your_towers').text()) - 1);
    update_stats();
});

$('#your_kill_plus').click(function() {
    $('#your_kills').text(parseInt($('#your_kills').text()) + 1);
    update_stats();
});

$('#your_kill_minus').click(function() {
    $('#your_kills').text(Math.max(parseInt($('#your_kills').text()) - 1, 0));
    update_stats();
});

$('#their_inhib_plus').click(function() {
    $('#their_inhibs').text(parseInt($('#their_inhibs').text()) + 1);
    update_stats();
});

$('#their_inhib_minus').click(function() {
    $('#their_inhibs').text(parseInt($('#their_inhibs').text()) - 1);
    update_stats();
});

$('#their_tower_plus').click(function() {
    $('#their_towers').text(parseInt($('#their_towers').text()) + 1);
    update_stats();
});

$('#their_tower_minus').click(function() {
    $('#their_towers').text(parseInt($('#their_towers').text()) - 1);
    update_stats();
});

$('#their_kill_plus').click(function() {
    $('#their_kills').text(parseInt($('#their_kills').text()) + 1);
    update_stats();
});

$('#their_kill_minus').click(function() {
    $('#their_kills').text(Math.max(parseInt($('#their_kills').text()) - 1, 0));
    update_stats();
});

update_stats();

</script>
